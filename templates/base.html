{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Local Secrets - Project Management Admin Dashboard  
    </title>
    <link rel="shortcut icon" href="{% static '/images/favicon.png' %}" type="image/png">
    <!-- GOOGLE FONT -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <!-- BOXICONS -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{% static 'css/icons.min.css' %}">

    <link rel="stylesheet" href="{% static 'libs/date-picker/datepicker.css' %}">
    <!-- APP CSS -->
 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="{% static 'css/grid.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <!-- Add SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

 <!-- jQuery (required for DataTables) -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script src="https://kit.fontawesome.com/e8b7cdfcf9.js" crossorigin="anonymous"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" /> <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
 <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />

 <style>
    body {
    font-family: sans-serif; 
    color: var(--text-color);
    position: relative;
    font-size: 16px;
}
    .sidebar-expand.active .sidebar {
        transition: transform 0.3s ease-in-out;
        max-width: 100%;
        z-index: 1111; 
    }
        .badge-info {
        color: rgb(255, 255, 255);
        background-color: rgb(10, 153, 46);
    }
     
        .badge-info {
            color: rgb(255, 255, 255);
            background-color: rgb(10, 153, 46);
        }
        .loader {
        border: 5px solid #f3f3f3; /* Light grey */
        border-top: 5px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        display: none; /* Hidden by default */
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
        /* Overlay style */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 1000; /* Ensure it's above other elements */
            display: none; /* Initially hidden */
        }
    
        #loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001; /* Above the overlay */
            display: none;
        }
 
    .alert-error {
    color: #eceff1;
    background-color: #dc3545;
    border-color: #ffeeba;
}
.success{
    color: #111;
    background-color: #8feccd;
    border-color: #ffeeba;
    padding: 10px;
}
    select.form-control:not([size]):not([multiple]) {
    height: calc(2.75rem + 2px);
}
</style>

</head>

<body class="sidebar-expand counter-scroll">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <a href="{%   if user.is_admin %}/{% else %}{% url 'ambassador_dashboard' %}{% endif %}">
                <img src="https://www.localsecrets.travel/wp-content/uploads/2024/08/cropped-cropped-logo-web-1.png" alt="logo">
            </a>
            
        
            <div class="sidebar-close" id="sidebar-close">
                <i class='bx bx-left-arrow-alt'></i>
            </div>
        </div>
        <!-- SIDEBAR MENU -->
        <div class="simlebar-sc" data-simplebar="init"><div class="simplebar-wrapper" style="margin: 0px;"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset" style="right: 0px; bottom: 0px;"><div class="simplebar-content-wrapper" style="height: 100%; overflow: hidden; padding-right: 0px; padding-bottom: 0px;"><div class="simplebar-content" style="padding: 0px;">
            <ul class="sidebar-menu tf">
                <li class="sidebar-submenu">
                    <a href="/" class="sidebar-menu-dropdown current-menu-item">
                        <i class='bx bxs-bolt'></i>
                        <span>Project</span>
                        <div class="dropdown-icon"><i class='bx bx-chevron-down'></i></div>
                    </a>    
                    <ul class="sidebar-menu sidebar-menu-dropdown-content active">
                   
                        {%   if user.is_admin  %}
                            <li>
                                <a href="{% url 'dashboard' %}">Project Dashboard</a>
                            </li>
                            <li>
                                <a href="{% url 'task_list' %}">Task List</a>
                            </li>
                            <li>
                                <a href="{% url 'upload_file' %}">New Project</a>
                            </li>
                        {% elif user.is_ambassador %}
                            <li>
                                <a href="{% url 'ambassador_dashboard' %}">Ambassador Dashboard</a>
                            </li>
                            <li>
                                <a href="{% url 'task_list' %}">Task List</a>
                            </li>

                        {% endif %}
                    </ul>
                    
                </li>
            
                <li class="sidebar-submenu">
                    <a href="#" class="sidebar-menu-dropdown">
                        <i class='bx bxs-business'></i>
                        <span>Businesses</span>
                        <div class="dropdown-icon"><i class='bx bx-chevron-down'></i></div>
                    </a>
                    <ul class="sidebar-menu sidebar-menu-dropdown-content">
                        <li>
                            <a href="{% url 'business_list' %}">
                                View All Businesses
                            </a>
                        </li>
                        {%   if user.is_admin %}
                        <li>
                            <a href="{% url 'destination_management' %}">
                                View All Destinations
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'create_destination' %}">
                                Create Destinations
                            </a>
                        </li>
         

                        {% endif %}
                    </ul>
                </li>
            
                {%   if user.is_admin %}
                <li class="sidebar-submenu">
                    <a href="#" class="sidebar-menu-dropdown">
                        <i class='bx bxs-user-account'></i>
                        <span>User Management</span>
                        <div class="dropdown-icon"><i class='bx bx-chevron-down'></i></div>
                    </a>
                    <ul class="sidebar-menu sidebar-menu-dropdown-content">
                        <li>
                            <a href="{% url 'user_management' %}">
                                Manage Users
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'create_user' %}">
                                Add New User
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="sidebar-submenu">
                    <a href="#" class="sidebar-menu-dropdown">
                        <i class='bx bxs-bolt'></i>
                        <span>Events</span>
                        <div class="dropdown-icon"><i class='bx bx-chevron-down'></i></div>
                    </a>
                    <ul class="sidebar-menu sidebar-menu-dropdown-content">
                        <li>
                            <a href="{% url 'search_events' %}">
                                Search Events
                            </a>
                        </li>
           
                    </ul>
                </li>

            
                <li>
                    <a href="{% url 'admin:index' %}">
                        <i class='bx bxs-dashboard'></i>
                        <span>Admin View</span>
                    </a>
                </li>
                {% endif %}
            
                <li>
                    <a href="{% url 'user_profile' %}">
                        <i class='bx bxs-user-circle'></i>
                        <span>My Profile</span>
                    </a>
                </li>
            
                <li>
                    <a href="{% url 'password_change' %}">
                        <i class='bx bxs-lock-alt'></i>
                        <span>Change Password</span>
                    </a>
                </li>
            
                <li>
                    <a href="{% url 'logout' %}">
                        <i class='bx bxs-log-out'></i>
                        <span>Logout</span>
                    </a>
                </li>
            
                <li>
                    <a class="darkmode-toggle" id="darkmode-toggle" onclick="switchTheme()">
                        <div>
                            <i class='bx bx-cog mr-10'></i>
                            <span>darkmode</span>
                        </div>
                        <span class="darkmode-switch"></span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
</div>
</div>            
</div>
        <!-- END SIDEBAR MENU -->
    </div>
    <!-- END SIDEBAR -->
    <!-- Main Header -->
    <div class="main-header">
        <div class="d-flex">
            <div class="mobile-toggle" id="mobile-toggle">
                <i class='bx bx-menu'></i>
            </div>
            <div class="main-title">
                
            </div>
        </div>

        <div class="d-flex align-items-center">

            <div class="dropdown d-inline-block d-lg-none ms-2">

                    <form class="p-3">
                        <div class="form-group m-0">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                                <div class="input-group-append">
                                    <button class="btn btn-primary h-100" type="submit"><i class='bx bx-search-alt' ></i></button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="dropdown d-inline-block">       
            </div>
            {% load static %}  <!-- Make sure to load static files -->
            <div class="dropdown d-inline-block mt-18">
                <button type="button" class="btn btn-link" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">

                    <span class="pulse-css"></span>
                    <span class="info d-xl-inline-block  color-span">
                        <span class="d-block fs-20 font-w600 mt-18">{{ user.username }}</span>
                        <span class="d-block mt-7">{{ user.email }}</span>
                    </span>
                    <i class="bx bx-chevron-down"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end">
                    {% if user.is_authenticated %}
                        <!-- Common items for all authenticated users -->
                        <a class="dropdown-item" href="{% url 'user_profile' %}">
                            <i class="bx bx-user font-size-16 align-middle me-1"></i> 
                            <span>Profile</span>
                        </a>
                        
                        {% if user.is_admin == True  %}
                            <!-- Admin-specific items -->
                            <a class="dropdown-item" href="{% url 'admin:index' %}">
                                <i class="bx bx-cog font-size-16 align-middle me-1"></i> 
                                <span>Admin Panel</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'user_management' %}">
                                <i class="bx bx-group font-size-16 align-middle me-1"></i> 
                                <span>User Management</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'destination_management' %}">
                                <i class="bx bx-map font-size-16 align-middle me-1"></i> 
                                <span>Manage Destinations</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'business_list' %}">
                                <i class="bx bx-store font-size-16 align-middle me-1"></i> 
                                <span>Manage Businesses</span>
                            </a>
                        {% endif %}
                
                        {% if user.is_ambassador %}
                            <!-- Ambassador-specific items -->
                            <a class="dropdown-item" href="{% url 'ambassador_dashboard' %}">
                                <i class="bx bx-chart font-size-16 align-middle me-1"></i> 
                                <span>Ambassador Dashboard</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'ambassador_businesses' %}">
                                <i class="bx bx-store font-size-16 align-middle me-1"></i> 
                                <span>Manage Businesses</span>
                            </a>
                        {% endif %}
                
                        <!-- Settings for all authenticated users -->
                        <a class="dropdown-item d-block" href="{% url 'user_profile' %}">
                            <span class="badge bg-success float-end">{{ user.unread_notifications_count }}</span>
                            <i class="bx bx-wrench font-size-16 align-middle me-1"></i> 
                            <span>Settings</span>
                        </a>
                
                        <div class="dropdown-divider"></div>
                
                        <!-- Logout for all authenticated users -->
                        <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                            <i class="bx bx-power-off font-size-16 align-middle me-1 text-danger"></i> 
                            <span>Logout</span>
                        </a>
                    {% else %}
                        <!-- For non-authenticated users -->
                        <a class="dropdown-item" href="{% url 'login' %}">
                            <i class="bx bx-log-in font-size-16 align-middle me-1"></i> 
                            <span>Login</span>
                        </a>
                    {% endif %}
                </div>
            </div>

    </div>

        
        </div>
        <!-- End Main Header -->

    <!-- MAIN CONTENT -->
    <div class="main">
        {% block content %}
        {% endblock %}


    </div>
    <!-- END MAIN CONTENT -->

    <div class="overlay"></div>
    <div id="scraping-status" style="display: none;">
        <p id="status-message">Business data is in progress. Please wait...</p>
    </div>
    
    <!-- SCRIPT -->
         {{ task_id }}  {% if task_id %}   
    <script>     
        const taskId = "{{ task_id }}";
        function checkTaskStatus() {
            $.ajax({
                url: "{% url 'check_task_status' task_id=taskId %}",
                method: 'GET',
                success: function(response) {
                    if (response.status === 'IN_PROGRESS') {
                        $('#scraping-status').show();
                        $('#status-message').text('Scraping is in progress. Please wait...');
                    } else if (response.status === 'COMPLETED') {
                        $('#scraping-status').hide();
                        alert('Scraping completed successfully!');
                    } else if (response.status === 'FAILED') {
                        $('#scraping-status').hide();
                        alert('Scraping failed. Please try again later.');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error checking task status:', error);
                    $('#scraping-status').hide();
                }
            });
        }
    
        setInterval(checkTaskStatus, 5000);
   
    </script>
         {% endif %}

    <!-- APEX CHART 
 
    <script src="{% static '/libs/jquery/jquery.min.js' %}"></script>
    <script src="{% static '/libs/jquery/jquery-ui.min.js' %}"></script>-->
    <!-- jQuery (required by Select2) -->

<!-- Select2 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>

    <script src="{% static '/libs/moment/min/moment.min.js' %}"></script>
    <script src="{% static '/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static '/libs/peity/jquery.peity.min.js' %}"></script>
    <script src="{% static '/libs/chart.js/Chart.bundle.min.js' %}"></script>
    <script src="{% static '/libs/owl.carousel/owl.carousel.min.js' %}"></script>
    <script src="{% static '/js/countto.js' %}"></script>
    <script src="{% static '/libs/date-picker/datepicker.js' %}"></script>
    <script src="{% static '/libs/simplebar/simplebar.min.js' %}"></script>
    <script src="{% static '/libs/apexcharts/apexcharts.js' %}"></script>
  
    <!-- APP JS -->
    <script src="{% static '/js/main.js' %}"></script>
    <script src="{% static '/js/shortcode.js' %}"></script>
    <script src="{% static '/js/pages/datepicker.js' %}"></script>
 
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 
</body>

</html>

