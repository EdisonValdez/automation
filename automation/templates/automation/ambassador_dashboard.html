{% extends 'base.html' %}
{% load project_tags %}
{% block content %}
<style><style>
    .custom-progress-container {
        width: 250px;
        padding: 5px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .custom-progress {
        height: 25px;
        display: flex;
        border-radius: 8px;
        overflow: hidden;
        background: #e9ecef;
        position: relative;
        transition: all 0.3s ease;
    }

    .progress-segment {
        display: flex;
        align-items: center;
        justify-content: center;
        transition: width 0.6s ease;
        position: relative;
        min-width: 30px;
    }

    .progress-segment:not(:last-child) {
        border-right: 1px solid rgba(255,255,255,0.3);
    }

    .progress-label {
        color: white;
        font-size: 0.75rem;
        font-weight: bold;
        text-shadow: 0 1px 1px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .progress-stats {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 80px;
    }

    .total-count {
        font-size: 1.2rem;
        font-weight: bold;
        color: #495057;
    }

    .total-label {
        font-size: 0.75rem;
        color: #6c757d;
    }

    /* Status colors with improved visibility */
    .bg-success {
        background-color: #28a745 !important;
    }

    .bg-warning {
        background-color: #ffc107 !important;
    }

    .bg-info {
        background-color: #17a2b8 !important;
    }

    .bg-primary {
        background-color: #0d6efd !important;
    }

    /* Hover effects */
    .progress-segment:hover {
        filter: brightness(110%);
    }

    /* Empty state */
    .custom-progress.empty {
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
    }

    .no-data {
        color: #6c757d;
        font-size: 0.8rem;
    }

    /* Animation for segments */
    @keyframes growWidth {
        from { width: 0; }
        to { width: 100%; }
    }

    .progress-segment {
        animation: growWidth 0.6s ease-out;
    } 
.progress {  background-color: #f0f0f0;border-radius: 15px;overflow: hidden;}.progress-bar { text-align: center;line-height: 24px;font-size: 0.8rem;font-weight: bold;transition: width 0.6s ease;
}.status-pill {padding: 0.5rem 1rem; border-radius: 20px;font-size: 0.9rem;display: inline-flex;align-items: center;gap: 0.5rem;
}.status-pill i {font-size: 1rem;}.task-card {transition: transform 0.2s ease, box-shadow 0.2s ease;}.task-card:hover {transform: translateY(-5px);box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;}.task-card .card-title {color: #2c3e50;font-weight: 600;}.task-card .card-title a:hover {color: var(--bs-primary);}.progress {background-color: #eef2f7;border-radius: 10px;}.progress-bar {background-color: var(--bs-primary);border-radius: 10px;}.empty-state {padding: 2rem;background: #f8f9fa;border-radius: 1rem;}.empty-state i {color: #dee2e6;}.table th {font-weight: 600;background: #f8f9fa;}.table td {vertical-align: middle;}.badge {padding: 0.5em 1em;font-weight: 500;}.btn-icon {padding: 0.25rem;line-height: 1;border: none;background: transparent;}.btn-icon:hover {background: #f8f9fa;border-radius: 0.25rem;}.pagination {margin-bottom: 0;}.page-link {border: none;padding: 0.5rem 1rem;color: var(--bs-primary);}.page-link:hover {background: #f8f9fa;}@media (prefers-color-scheme: dark) {.task-card {background: #2d3436;}.empty-state {background: #2d3436;}.table th {background: #2d3436;}}</style>

<div class="main-content project"> 
    <div class="row">
        <div class="col-12">
            <div class="page-title-wrapper">
                <h1 class="page-title">
                    <span class="title-icon">
                        <i class="bx bx-crown fs-3 me-2 text-primary"></i>
                    </span>
                    <span class="title-text"> Ambassador Dashboard
                    </span>
                </h1>
            </div>
        </div>
    </div>  
    <!-- Places to Review Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-transparent">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-tasks me-2"></i>&nbsp;
                                Content Curation Progress
                            </h5>&nbsp;
                            <div class="ms-3 d-flex align-items-center">
                                <div class="custom-progress-container">
                                    {% if status_counts.total > 0 %}
                                        <div class="custom-progress">
                                            <div class="progress-segment bg-success" 
                                                 style="width: {{ status_percentages.completed }}%"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="top"
                                                 title="Completed: {{ status_counts.completed }}">
                                                {% if status_counts.completed > 0 %}
                                                    <span class="progress-label">{{ status_counts.completed }}</span>
                                                {% endif %}
                                            </div>
                                            <div class="progress-segment bg-warning" 
                                                 style="width: {{ status_percentages.in_progress }}%"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="top"
                                                 title="In Progress: {{ status_counts.in_progress }}">
                                                {% if status_counts.in_progress > 0 %}
                                                    <span class="progress-label">{{ status_counts.in_progress }}</span>
                                                {% endif %}
                                            </div>
                                            <div class="progress-segment bg-info" 
                                                 style="width: {{ status_percentages.pending }}%"
                                                 data-bs-toggle="tooltip"
                                                 data-bs-placement="top"
                                                 title="Pending: {{ status_counts.pending }}">
                                                {% if status_counts.pending > 0 %}
                                                    <span class="progress-label">{{ status_counts.pending }}</span>
                                                {% endif %}
                                            </div>
                                            {% if status_counts.done > 0 %}
                                                <div class="progress-segment bg-primary" 
                                                     style="width: {{ status_percentages.done }}%"
                                                     data-bs-toggle="tooltip"
                                                     data-bs-placement="top"
                                                     title="Done: {{ status_counts.done }}">
                                                    <span class="progress-label">{{ status_counts.done }}</span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <div class="custom-progress empty">
                                            <span class="no-data">No tasks available</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="ms-3 progress-stats">
                                    <span class="total-count">{{ status_counts.total }}</span>
                                    <span class="total-label">Total Tasks</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                
                    <!-- Status Summary -->
                    <div class="row mt-3">
                        <div class="col-10">
                            <div class="d-flex gap-3">
                                <div class="status-pill bg-success-subtle">
                                    <i class="fas fa-check-circle text-success"></i>
                                    {{ status_counts.completed }} Completed
                                </div>
                                <div class="status-pill bg-warning-subtle">
                                    <i class="fas fa-clock text-warning"></i>
                                    {{ status_counts.in_progress }} In Progress
                                </div>
                                <div class="status-pill bg-info-subtle">
                                    <i class="fas fa-hourglass-start text-info"></i>
                                    {{ status_counts.pending }} Pending
                                </div>
                                {% if status_counts.done > 0 %}
                                    <div class="status-pill bg-primary-subtle">
                                        <i class="fas fa-flag-checkered text-primary"></i>
                                        {{ status_counts.done }} Done
                                    </div>
                                {% endif %}
                            </div>
                        </div> 
                            <div class="col-2">
                                <a href="{% url 'task_list' %}" class="btn btn-secondary">Go To Content List</a>
                     
                        </div>
                    </div>
                </div>
        
                <div class="card-body">
                    {% if tasks %}
                    <div class="row g-4">
                        {% for task in tasks %}
                        {% if task.status != 'DONE' %}
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="card task-card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-3">
                                        <span style="color:white" class="badge {% if task.status == 'IN_PROGRESS' %}bg-success
                                                         {% elif task.status == 'PENDING' %}bg-warning
                                                         {% elif task.status == 'FAILED' %}bg-danger
                                                         {% else %}bg-secondary{% endif %}">
                                            {{ task.status|default:"Pending" }}
                                        </span>
                                        <div class="dropdown">
                                            <button class="btn btn-icon" data-bs-toggle="dropdown">
                                                <i class="bx bx-dots-vertical-rounded"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li>
                                                    <a class="dropdown-item" href="{% url 'task_detail' task.id %}">
                                                        <i class="bx bx-show me-2"></i>View Details
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>

                                    <h5 class="card-title mb-3 mt-18">
                                        <a href="{% url 'task_detail' task.id %}" class="text-decoration-none">
                                            {{ task.project_title }}
                                        </a>
                                    </h5>

                                    <div class="task-meta mb-3 mt-17">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bx bx-calendar me-2 text-muted"></i>
                                            <small class="text-muted">Started: {{ task.created_at|date:"M d, Y" }}</small>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <i class="bx bx-time me-2 text-muted"></i>
                                            <small class="text-muted">Due: {{ task.deadline|date:"M d, Y" }}</small>
                                        </div>
                                    </div>

                                    <div class="progress mt-4" style="height: 6px;">
                                        <div class="progress-bar" role="progressbar" style="width: 45%"></div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent border-top-0">
                                    <a href="{% url 'task_detail' task.id %}" class="btn btn-primary w-100">
                                        Review Now
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <!-- Empty State -->
                    <div class="text-center py-5">
                        <div class="empty-state">
                            <i class="bx bx-task-x display-4 text-muted mb-3"></i>
                            <h6>No Places to Review</h6>
                            <p class="text-muted mb-0">
                                You're all caught up! Check back later for new places to review.
                            </p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>


    <!-- Recent Businesses Section -->
    <div class="card">
        <div class="card-header bg-transparent">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Recent Businesses</h5>
                <!--<div class="card-actions">
                    <button class="btn btn-light" id="refreshTable">
                        <i class="bx bx-refresh me-2"></i>Refresh
                    </button>
                </div>-->
            </div>
        </div>
        
        <div class="card-body">
            {% if businesses %}
            <div class="table-responsive">
                <table class="table table-hover" id="business-table">
                    <thead>
                        <tr class="top">
                            <th>Business Name</th>
                            <th>Category</th>
                            <th>Address(es)</th> 
                            <th>City</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                        <tr> 
                            <th><input type="text" placeholder="Search Business Name" /></th>
                            <th><input type="text" placeholder="Search Category" /></th>
                            <th><input type="text" placeholder="Search Address(es)" /></th>
                            <th><input type="text" placeholder="Search City" /></th>
                            <th><input type="text" placeholder="Search Status" /></th>
                            <th></th>
                        
                        </tr>
                    </thead>

                    <tbody>
                        {% for business in businesses %}
                        <tr class="{% cycle 'odd' 'even' %}">
                            <td>
                                <a href="{% url 'business_detail' business.id %}" class="d-flex"><span>{{ business.title }}</span></a>
                            </td>
                            <td>{{ business.category_name }}</td>
                            <td>
                                {% if business.address %}
                                    {{ business.address|truncatechars:30 }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td>{{ business.destination }}</td>
                            <td>
                                <span class="badge 
                                    {% if business.status == 'REVIEWED' %} badge-success 
                                    {% elif business.status == 'PENDING' %} badge-warning 
                                    {% elif business.status == 'DISCARDED' %} badge-danger 
                                    {% elif business.status == 'IN_PRODUCTION' %} badge-primary 
                                    {% endif %}">
                                    {{ business.get_status_display }}
                                </span>
                            </td>
                            <td>
                                <div class="dropdown">
                                    <a href="javascript:void(0);" class="btn-link" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bx bx-dots-horizontal-rounded"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="{% url 'business_detail' business.id %}">
                                            <i class="bx bx-info-circle font-size-16 align-middle me-1"></i>View
                                        </a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6">No businesses found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                                        
            </table>
        </div>
        {% else %}
        <!-- Empty State for Businesses -->
        <div class="text-center py-5">
            <div class="empty-state">
                <i class="bx bx-store display-4 text-muted mb-3"></i>
                <h6>No Businesses Found</h6>
                <p class="text-muted mb-0">
                    There are no businesses to display at the moment.
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
</div>

 
<script>
    // Initialize DataTable
    $(document).ready(function() {
        const businessTable = $('#business-table').DataTable({
            pageLength: 24,
            order: [[0, 'desc']],
            language: {
                search: "",
                searchPlaceholder: "Search...",
            },
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                 "<'row'<'col-sm-12'tr>>" +
                 "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
        });
    
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function(tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });
    
        // Refresh table
        $('#refreshTable').click(function() {
            location.reload();
        });
    });
    </script>

<script>
    $(document).ready(function() {
        // Setup - add a text input to each footer cell
        $('#business-profile thead tr:eq(1) th').each(function (i) {
            var title = $(this).text();
            if (title !== 'Select' && title !== 'Action') {
                $('input', this).on('keyup change', function () {
                    if (table.column(i).search() !== this.value) {
                        table
                            .column(i)
                            .search(this.value)
                            .draw();
                    }
                });
            }
        });
    
 
    });
    
    </script>
{% endblock %}